<div flex ng-controller="BackofficeKbModelsDetailsCtrl">
    <div layout="column" layout-align="center center" ng-if="!model" flex class="md-padding">
        <md-progress-circular md-indeterminate="true"></md-progress-circular>
    </div>

    <div layout="column" ng-if="model" class="md-padding-left md-padding-right">
        <h2>{{ ::model.label1 }}</h2>

        <md-card>
            <md-tabs md-border-bottom="true" md-dynamic-height>
                <md-tab label="{{ 'CASES Diagnostic' | translate }}">
                    <md-toolbar class="md-table-toolbar md-default" ng-hide="questions.selected.length || questions.filter.show">
                        <div class="md-toolbar-tools">
                            <h2 class="md-title" translate>Associated questions (projects)</h2>
                            <div flex></div>
                            <md-button class="md-icon-button" ng-click="questions.filter.show = true">
                                <md-icon>search</md-icon>
                            </md-button>
                        </div>
                    </md-toolbar>

                    <md-toolbar class="md-table-toolbar md-default" ng-show="questions.filter.show && !questions.selected.length">
                        <div class="md-toolbar-tools">
                            <md-icon>search</md-icon>
                            <form flex name="questions.filter.form">
                                <input type="text" ng-model="questions.query.filter" ng-model-options="questions.filter.options" placeholder="{{ 'Search...' | translate }}">
                            </form>
                            <md-button class="md-icon-button" ng-click="removeQuestionsFilter()">
                                <md-icon>close</md-icon>
                            </md-button>
                        </div>
                    </md-toolbar>

                    <md-toolbar class="md-table-toolbar alternate" ng-show="questions.selected.length">
                        <div class="md-toolbar-tools" layout-align="space-between center">
                            <div>{{questions.selected.length}} {{questions.selected.length > 1 ? 'items' : 'item'}} selected</div>
                            <md-button class="md-icon-button" ng-click="deleteQuestionMass($event)">
                                <md-icon>delete</md-icon>
                            </md-button>
                        </div>
                    </md-toolbar>

                    <md-table-container flex>
                        <table md-table md-row-select multiple ng-model="questions.selected" md-progress="questions.promise">
                            <thead md-head md-order="questions.query.order" md-on-reorder="updateQuestions">
                            <tr md-row>
                                <th md-column md-order-by="category"><span translate>Active</span></th>
                                <th md-column md-order-by="label1"><span translate>Label</span></th>
                                <th md-column><span translate>Actions</span></th>
                            </tr>
                            </thead>

                            <tbody md-body>
                            <tr md-row md-select="question" md-select-id="id" ng-repeat="question in questions.items.questions">
                                <td md-cell><md-icon>{{ question.category.label1 }}</md-icon></td>
                                <td md-cell>{{ question.label1 }}</td>
                                <td md-cell>
                                    <md-button class="md-icon-button" ng-click="editQuestion($event, question)"><md-icon>edit</md-icon></md-button>
                                    <md-button class="md-icon-button" ng-click="deleteQuestion($event, question)"><md-icon>delete</md-icon></md-button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </md-table-container>

                    <md-table-pagination md-limit="questions.query.limit" md-limit-options="[5, 10, 15]" md-page="questions.query.page"
                                         md-total="{{questions.items.count}}" md-on-paginate="updateQuestions" md-page-select md-label="{{paginationLabels}}"></md-table-pagination>

                    <div layout="row" class="md-padding">
                        <span flex></span>
                        <md-button class="md-fab md-accent" aria-label="{{ 'New question' | translate }}" ng-click="createNewQuestion($event)">
                            <md-tooltip md-direction="left">
                                {{ 'New question' | translate }}
                            </md-tooltip>
                            <md-icon>add</md-icon>
                        </md-button>
                    </div>
                </md-tab>

                <md-tab label="{{ 'Risk analysis' | translate }}">
                    <div layout="row" layout-padding>
                        <div flex="20" layout="column">
                            <p class="md-subheader" translate>Risk analysis</p>
                            <md-input-container class="md-block">
                                <md-icon>search</md-icon>
                                <label translate>Search an instance...</label>
                                <input type="text">
                            </md-input-container>

                            <tree-dnd
                                      tree-data="tree_data"
                                      tree-control="my_tree"
                                      filter="_filter"
                                      primary-key="id"
                                      column-defs="col_defs"
                                      expand-on="expanding_property"
                                      template-url="tree-dnd-template-render.html"
                                      indent="25"
                                      indent-plus="0"
                                      indent-unit="px"
                                      enable-move="true">

                            </tree-dnd>

                            <p></p>

                            <p class="md-subheader" translate>Objects library</p>
                            <div layout="row" layout-align="center center">
                                <md-input-container class="md-block">
                                    <md-icon>search</md-icon>
                                    <label translate>Search an object...</label>
                                    <input type="text">
                                </md-input-container>
                                <md-button class="md-icon-button"><md-icon>add</md-icon></md-button>
                            </div>

                            <ul class="md-treeview">
                                <li class="md-treeview-root">
                                    <a ui-sref="main.kb_mgmt.info_risk.object({objectId: object.id})"><md-icon>place</md-icon> {{ object.name1 }}</a>
                                    <ul>
                                        <li ng-repeat="node in composition"
                                            ng-class="{'md-treeview-branch': node.children && node.children.length > 0}"
                                            ng-include="'objlibs.tree_item_template.html'"></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div flex ui-view="anr"></div>
                    </div>

                </md-tab>

                <md-tab label="{{ 'Evaluation scales' | translate }}">
                    <div class="md-padding-left md-padding-right" layout="column">
                        <div layout="row">
                            <h4><span translate>Impacts scale:</span> [
                                <span class="small text-blue" inline-edit="impacts_scale_min" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-validation="inlineNumberValidator(newValue)" inline-edit-on-click></span> -
                                <span class="small text-blue" inline-edit="impacts_scale_max" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-validation="inlineNumberValidator(newValue)" inline-edit-on-click></span> ]
                            </h4>

                            <md-switch ng-model="impacts_scale_composed" class="md-padding-left">
                                {{ 'Composed' | translate }}
                            </md-switch>
                        </div>



                        <div layout="row" ng-if="impacts_scale_composed">
                            <p translate>Manage sub-scales:</p>
                            <md-button ng-click="editSubscale($event, 'c')">{{ 'Confidentiality' | translate }}</md-button>
                            <md-button ng-click="editSubscale($event, 'i')">{{ 'Integrity' | translate }}</md-button>
                            <md-button ng-click="editSubscale($event, 'd')">{{ 'Availability' | translate }}</md-button>
                        </div>

                        <table class="md-html-table">
                            <thead>
                            <tr>
                                <th></th>
                                <th translate>Confidentiality</th>
                                <th translate>Integrity</th>
                                <th translate>Availability</th>
                                <th translate>Reputation</th>
                                <th translate>Operational</th>
                                <th translate>Legal</th>
                                <th translate>Financial</th>
                                <th translate>Person</th>
                                <!-- <th ng-repeat="custom in customColumns"></th> -->
                            </tr>
                            </thead>

                            <tbody>
                            <tr ng-repeat="i in range(impacts_scale_min, impacts_scale_max)">
                                <td>{{ i }}</td>
                                <td><span inline-edit="impact[i].confidentiality" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></td>
                                <td><span inline-edit="impact[i].integrity" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></td>
                                <td><span inline-edit="impact[i].availability" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></td>
                                <td><span inline-edit="impact[i].reputation" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></td>
                                <td><span inline-edit="impact[i].operational" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></td>
                                <td><span inline-edit="impact[i].legal" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></td>
                                <td><span inline-edit="impact[i].financial" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></td>
                                <td><span inline-edit="impact[i].person" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></td>
                            </tr>
                            </tbody>
                        </table>

                        <h4><span translate>Threats scale:</span> [
                            <span class="small text-blue" inline-edit="threats_scale_min" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-validation="inlineNumberValidator(newValue)" inline-edit-on-click></span> -
                            <span class="small text-blue" inline-edit="threats_scale_max" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-validation="inlineNumberValidator(newValue)" inline-edit-on-click></span> ]
                        </h4>

                        <ul class="no-list-style">
                            <li ng-repeat="i in range(threats_scale_min, threats_scale_max)">{{i}}. <span inline-edit="threat[i]" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></li>
                        </ul>

                        <h4><span translate>Vulnerabilities scale:</span> [
                            <span class="small text-blue" inline-edit="vulns_scale_min" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-validation="inlineNumberValidator(newValue)" inline-edit-on-click></span> -
                            <span class="small text-blue" inline-edit="vulns_scale_max" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-validation="inlineNumberValidator(newValue)" inline-edit-on-click></span> ]
                        </h4>

                        <ul class="no-list-style">
                            <li ng-repeat="i in range(vulns_scale_min, vulns_scale_max)">{{i}}. <span inline-edit="vuln[i]" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></li>
                        </ul>
                    </div>
                </md-tab>
            </md-tabs>
        </md-card>
    </div>
</div>

<script type="text/ng-template" id="tree-dnd-template-render.html">
<table ng-class="$tree_class">
    <tbody tree-dnd-nodes>
    <tr tree-dnd-node="node" ng-repeat="node in tree_nodes track by node.__hashKey__"
        ng-show="node.__visible__" ng-class="node.__selected__ ? 'active':''" ng-click="onSelect(node)">
        <td tree-dnd-node-handle ng-style="expandingProperty.cellStyle ? expandingProperty.cellStyle : {'padding-left': $callbacks.calsIndent(node.__level__)}"
            ng-class="expandingProperty.cellClass" compile="expandingProperty.cellTemplate">
            <a data-nodrag><md-icon ng-click="toggleExpand(node)" class="tree-icon" ng-if="node.__children__.length > 0">{{ node.__expanded__ ? 'expand_less' : 'expand_more' }}</md-icon></a>
            <a data-nodrag ng-if="!node.__children__ || node.__children__.length == 0" ui-sref="main"><md-icon>class</md-icon></a>
            {{node[expandingProperty.field] || node[expandingProperty]}}
        </td>
    </tr>
    </tbody>
</table>
</script>

<script type="text/ng-template" id="objlibs.tree_item_template.html">
    <a ui-sref="main.kb_mgmt.info_risk.object({objectId: node.id})"><md-icon>{{ node.children && node.children.length > 0 ? 'add': 'note' }}</md-icon> {{ node.name1 }}</a>
    <md-button class="md-icon-button"><md-icon>arrow_upward</md-icon></md-button>
    <md-button class="md-icon-button"><md-icon>arrow_downward</md-icon></md-button>
    <md-button class="md-icon-button" ng-click="deleteCompositionItem($event, node)"><md-icon>delete</md-icon></md-button>

    <ul ng-if="node.children && node.children.length > 0">
        <li ng-repeat="node in node.children"
            ng-class="{'md-treeview-branch': node.children && node.children.length > 0}"
            ng-include="'objlibs.tree_item_template.html'"></li>
    </ul>
</script>